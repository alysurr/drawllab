{"ast":null,"code":"var _jsxFileName = \"/Users/alysurr/Documents/Capstone/drawllab/src/pages/CanvasPage/CanvasPage.jsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport './CanvasPage.scss';\nimport React, { useEffect, useLayoutEffect, useState } from 'react';\nimport { Link } from 'react-router-dom';\nimport rough from 'roughjs/bundled/rough.esm';\nimport { getStroke } from 'perfect-freehand'; // ----- icons for toolbar -----\n\nimport paintbrush from \"../../assets/images/paintbrush.svg\";\nimport line from \"../../assets/images/draw-line.svg\";\nimport square from \"../../assets/images/rectangle.svg\";\nimport select from \"../../assets/images/select.svg\";\nimport home from '../../assets/images/home.png';\nimport about from '../../assets/images/about.png';\nimport deleteicon from '../../assets/images/delete.png';\nimport colorpicker from \"../../assets/images/color-picker.svg\";\nimport undoIcon from \"../../assets/images/undo.svg\";\nimport redoIcon from \"../../assets/images/redo.svg\"; // ----- Functionality for Tools -----\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst generator = rough.generator();\n\nconst createElement = (id, x1, y1, x2, y2, type) => {\n  switch (type) {\n    case \"line\":\n    case \"rectangle\":\n      const roughElement = type === \"line\" ? generator.line(x1, y1, x2, y2, {\n        roughness: 1.25,\n        bowing: 2,\n        strokeWidth: 2\n      }) : generator.rectangle(x1, y1, x2 - x1, y2 - y1, {\n        roughness: 1.25,\n        bowing: 2,\n        strokeWidth: 3\n      });\n      return {\n        id,\n        x1,\n        y1,\n        x2,\n        y2,\n        type,\n        roughElement\n      };\n\n    case \"paintbrush\":\n      return {\n        id,\n        type,\n        points: [{\n          x: x1,\n          y: y1\n        }]\n      };\n\n    default:\n      throw new Error(`unrecognized: ${type}`);\n  }\n};\n\nconst nearPoint = (x, y, x1, y1, name) => {\n  return Math.abs(x - x1) < 5 && Math.abs(y - y1) < 5 ? name : null;\n};\n\nconst onLine = (x1, y1, x2, y2, x, y, maxDistance = 1) => {\n  const a = {\n    x: x1,\n    y: y1\n  };\n  const b = {\n    x: x2,\n    y: y2\n  };\n  const c = {\n    x,\n    y\n  };\n  const offset = distance(a, b) - (distance(a, c) + distance(b, c));\n  return Math.abs(offset) < maxDistance ? \"inside\" : null;\n};\n\nconst positionInElement = (x, y, element) => {\n  const {\n    type,\n    x1,\n    x2,\n    y1,\n    y2\n  } = element;\n\n  switch (type) {\n    case \"line\":\n      const on = onLine(x1, y1, x2, y2, x, y);\n      const start = nearPoint(x, y, x1, y1, \"start\");\n      const end = nearPoint(x, y, x2, y2, \"end\");\n      return start || end || on;\n\n    case \"rectangle\":\n      const topLeft = nearPoint(x, y, x1, y1, \"tl\");\n      const topRight = nearPoint(x, y, x2, y1, \"tr\");\n      const bottomLeft = nearPoint(x, y, x1, y2, \"bl\");\n      const bottomRight = nearPoint(x, y, x2, y2, \"br\");\n      const inside = x >= x1 && x <= x2 && y >= y1 && y <= y2 ? \"inside\" : null;\n      return topLeft || topRight || bottomLeft || bottomRight || inside;\n\n    case \"paintbrush\":\n      const betweenAnyPoint = element.points.some((point, index) => {\n        const nextPoint = element.points[index + 1];\n        if (!nextPoint) return false;\n        return onLine(point.x, point.y, nextPoint.x, nextPoint.y, x, y, 5) != null;\n      });\n      return betweenAnyPoint ? \"inside\" : null;\n\n    default:\n      throw new Error(`Type not recognised: ${type}`);\n  }\n};\n\nconst distance = (a, b) => Math.sqrt(Math.pow(a.x - b.x, 2) + Math.pow(a.y - b.y, 2));\n\nconst getElementAtPosition = (x, y, elements) => {\n  return elements.map(element => ({ ...element,\n    position: positionInElement(x, y, element)\n  })).find(element => element.position !== null);\n};\n\nconst adjustElementCoordinates = element => {\n  const {\n    type,\n    x1,\n    y1,\n    x2,\n    y2\n  } = element;\n\n  if (type === \"rectangle\") {\n    const minX = Math.min(x1, x2);\n    const maxX = Math.max(x1, x2);\n    const minY = Math.min(y1, y2);\n    const maxY = Math.max(y1, y2);\n    return {\n      x1: minX,\n      y1: minY,\n      x2: maxX,\n      y2: maxY\n    };\n  } else {\n    if (x1 < x2 || x1 === x2 && y1 < y2) {\n      return {\n        x1,\n        y1,\n        x2,\n        y2\n      };\n    } else {\n      return {\n        x1: x2,\n        y1: y2,\n        x2: x1,\n        y2: y1\n      };\n    }\n  }\n};\n\nconst cursorForPosition = position => {\n  switch (position) {\n    case \"tl\":\n    case \"br\":\n    case \"start\":\n    case \"end\":\n      return \"nwse-resize\";\n\n    case \"tr\":\n    case \"bl\":\n      return \"nesw-resize\";\n\n    default:\n      return \"move\";\n  }\n};\n\nconst resizedCoordinates = (clientX, clientY, position, coordinates) => {\n  const {\n    x1,\n    y1,\n    x2,\n    y2\n  } = coordinates;\n\n  switch (position) {\n    case \"tl\":\n    case \"start\":\n      return {\n        x1: clientX,\n        y1: clientY,\n        x2,\n        y2\n      };\n\n    case \"tr\":\n      return {\n        x1,\n        y1: clientY,\n        x2: clientX,\n        y2\n      };\n\n    case \"bl\":\n      return {\n        x1: clientX,\n        y1,\n        x2,\n        y2: clientY\n      };\n\n    case \"br\":\n    case \"end\":\n      return {\n        x1,\n        y1,\n        x2: clientX,\n        y2: clientY\n      };\n\n    default:\n      return null;\n    //should not really get here...\n  }\n};\n\nconst useHistory = initialState => {\n  _s();\n\n  const [index, setIndex] = useState(0);\n  const [history, setHistory] = useState([initialState]);\n\n  const setState = (action, overwrite = false) => {\n    const newState = typeof action === \"function\" ? action(history[index]) : action;\n\n    if (overwrite) {\n      const historyCopy = [...history];\n      historyCopy[index] = newState;\n      setHistory(historyCopy);\n    } else {\n      const updatedState = [...history].slice(0, index + 1);\n      setHistory([...updatedState, newState]);\n      setIndex(prevState => prevState + 1);\n    }\n  };\n\n  const undo = () => index > 0 && setIndex(prevState => prevState - 1);\n\n  const redo = () => index < history.length - 1 && setIndex(prevState => prevState + 1);\n\n  return [history[index], setState, undo, redo];\n};\n\n_s(useHistory, \"iEmo9NqplUe5E9Qu5A/1RO54SF0=\");\n\nconst getSvgPathFromStroke = stroke => {\n  if (!stroke.length) return \"\";\n  const d = stroke.reduce((acc, [x0, y0], i, arr) => {\n    const [x1, y1] = arr[(i + 1) % arr.length];\n    acc.push(x0, y0, (x0 + x1) / 2, (y0 + y1) / 2);\n    return acc;\n  }, [\"M\", ...stroke[0], \"Q\"]);\n  d.push(\"Z\");\n  return d.join(\" \");\n};\n\nconst drawElement = (roughCanvas, context, element) => {\n  switch (element.type) {\n    case \"line\":\n    case \"rectangle\":\n      roughCanvas.draw(element.roughElement);\n      break;\n\n    case \"paintbrush\":\n      const stroke = getSvgPathFromStroke(getStroke(element.points, {\n        size: 8,\n        thinning: 0.5,\n        smoothing: 0.5,\n        streamline: 0.5\n      }));\n      context.fill(new Path2D(stroke));\n      break;\n\n    default:\n      throw new Error(`unrecognised: ${element.type}`);\n  }\n};\n\nconst adjustmentRequired = type => [\"line\", \"rectangle\"].includes(type);\n\nconst CanvasPage = () => {\n  _s2();\n\n  const [elements, setElements, undo, redo] = useHistory([]);\n  const [action, setAction] = useState(\"none\");\n  const [tool, setTool] = useState(\"paintbrush\");\n  const [selectedElement, setSelectedElement] = useState(null);\n  useLayoutEffect(() => {\n    const canvas = document.getElementById(\"canvas\");\n    const context = canvas.getContext(\"2d\");\n    context.clearRect(0, 0, canvas.width, canvas.height);\n    const roughCanvas = rough.canvas(canvas);\n    elements.forEach(element => drawElement(roughCanvas, context, element));\n  }, [elements]);\n  useEffect(() => {\n    const undoRedoFunction = e => {\n      if ((e.metaKey || e.ctrlKey) && e.key === \"z\") {\n        if (e.shiftKey) {\n          redo();\n        } else {\n          undo();\n        }\n      }\n    };\n\n    document.addEventListener(\"keydown\", undoRedoFunction);\n    return () => {\n      document.removeEventListener(\"keydown\", undoRedoFunction);\n    };\n  }, [undo, redo]);\n\n  const updateElement = (id, x1, y1, x2, y2, type) => {\n    const elementsCopy = [...elements];\n\n    switch (type) {\n      case \"line\":\n      case \"rectangle\":\n        elementsCopy[id] = createElement(id, x1, y1, x2, y2, type);\n        break;\n\n      case \"paintbrush\":\n        elementsCopy[id].points = [...elementsCopy[id].points, {\n          x: x2,\n          y: y2\n        }];\n        break;\n\n      default:\n        throw new Error(`unrecognised: ${type}`);\n    }\n\n    setElements(elementsCopy, true);\n  };\n\n  const handleMouseDown = e => {\n    const {\n      clientX,\n      clientY\n    } = e;\n\n    if (tool === \"select\") {\n      const element = getElementAtPosition(clientX, clientY, elements);\n\n      if (element) {\n        if (element.type === \"paintbrush\") {\n          const xOffsets = element.points.map(point => clientX - point.x);\n          const yOffsets = element.points.map(point => clientY - point.y);\n          setSelectedElement({ ...element,\n            xOffsets,\n            yOffsets\n          });\n        } else {\n          const offsetX = clientX - element.x1;\n          const offsetY = clientY - element.y1;\n          setSelectedElement({ ...element,\n            offsetX,\n            offsetY\n          });\n        }\n\n        setElements(prevState => prevState);\n\n        if (element.position === \"inside\") {\n          setAction(\"moving\");\n        } else {\n          setAction(\"resizing\");\n        }\n      }\n    } else {\n      const id = elements.length;\n      const element = createElement(id, clientX, clientY, clientX, clientY, tool);\n      setElements(prevState => [...prevState, element]);\n      setSelectedElement(element);\n      setAction(\"drawing\");\n    }\n  };\n\n  const handleMouseMove = e => {\n    const {\n      clientX,\n      clientY\n    } = e;\n\n    if (tool === \"select\") {\n      const element = getElementAtPosition(clientX, clientY, elements);\n      e.target.style.cursor = element ? cursorForPosition(element.position) : \"default\";\n    }\n\n    if (action === \"drawing\") {\n      const index = elements.length - 1;\n      const {\n        x1,\n        y1\n      } = elements[index];\n      updateElement(index, x1, y1, clientX, clientY, tool);\n    } else if (action === \"moving\") {\n      if (selectedElement.type === \"paintbrush\") {\n        const newPoints = selectedElement.points.map((_, index) => ({\n          x: clientX - selectedElement.xOffsets[index],\n          y: clientY - selectedElement.yOffsets[index]\n        }));\n        const elementsCopy = [...elements];\n        elementsCopy[selectedElement.id] = { ...elementsCopy[selectedElement.id],\n          points: newPoints\n        };\n        setElements(elementsCopy, true);\n      } else {\n        const {\n          id,\n          x1,\n          x2,\n          y1,\n          y2,\n          type,\n          offsetX,\n          offsetY\n        } = selectedElement;\n        const width = x2 - x1;\n        const height = y2 - y1;\n        const newX1 = clientX - offsetX;\n        const newY1 = clientY - offsetY;\n        updateElement(id, newX1, newY1, newX1 + width, newY1 + height, type);\n      }\n    } else if (action === \"resizing\") {\n      const {\n        id,\n        type,\n        position,\n        ...coordinates\n      } = selectedElement;\n      const {\n        x1,\n        y1,\n        x2,\n        y2\n      } = resizedCoordinates(clientX, clientY, position, coordinates);\n      updateElement(id, x1, y1, x2, y2, type);\n    }\n  };\n\n  const handleMouseUp = () => {\n    if (selectedElement) {\n      const index = selectedElement.id;\n      const {\n        id,\n        type\n      } = elements[index];\n\n      if ((action === \"drawing\" || action === \"resizing\") && adjustmentRequired(type)) {\n        const {\n          x1,\n          y1,\n          x2,\n          y2\n        } = adjustElementCoordinates(elements[index]);\n        updateElement(id, x1, y1, x2, y2, type);\n      }\n    }\n\n    setAction(\"none\");\n    setSelectedElement(null);\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"toolbar\",\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"radio\",\n        id: \"colorpick\",\n        checked: tool === \"colorpick\",\n        onChange: () => setTool(\"colorpick\"),\n        className: \"tool\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 338,\n        columnNumber: 4\n      }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n        htmlFor: \"colorpick\",\n        className: \"tool__label\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"tool__div\",\n          children: /*#__PURE__*/_jsxDEV(\"img\", {\n            src: colorpicker,\n            alt: \"colorpick icon\",\n            className: \"toolbar__icon\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 350,\n            columnNumber: 5\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 349,\n          columnNumber: 4\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 345,\n        columnNumber: 4\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"radio\",\n        id: \"paintbrush\",\n        checked: tool === \"paintbrush\",\n        onChange: () => setTool(\"paintbrush\"),\n        className: \"tool\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 354,\n        columnNumber: 4\n      }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n        htmlFor: \"paintbrush\",\n        className: \"tool__label\",\n        children: /*#__PURE__*/_jsxDEV(\"img\", {\n          src: paintbrush,\n          alt: \"paintbrush icon\",\n          className: \"toolbar__icon\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 365,\n          columnNumber: 5\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 361,\n        columnNumber: 4\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"radio\",\n        id: \"line\",\n        checked: tool === \"line\",\n        onChange: () => setTool(\"line\"),\n        className: \"tool\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 367,\n        columnNumber: 4\n      }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n        htmlFor: \"line\",\n        className: \"tool__label\",\n        children: /*#__PURE__*/_jsxDEV(\"img\", {\n          src: line,\n          alt: \"line icon\",\n          className: \"toolbar__icon\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 378,\n          columnNumber: 5\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 374,\n        columnNumber: 4\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"radio\",\n        id: \"rectangle\",\n        checked: tool === \"rectangle\",\n        onChange: () => setTool(\"rectangle\"),\n        className: \"tool\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 380,\n        columnNumber: 4\n      }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n        htmlFor: \"rectangle\",\n        className: \"tool__label\",\n        children: /*#__PURE__*/_jsxDEV(\"img\", {\n          src: square,\n          alt: \"rectangle icon\",\n          className: \"toolbar__icon\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 391,\n          columnNumber: 5\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 387,\n        columnNumber: 4\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"radio\",\n        id: \"select\",\n        checked: tool === \"select\",\n        onChange: () => setTool(\"select\"),\n        className: \"tool\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 393,\n        columnNumber: 4\n      }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n        htmlFor: \"select\",\n        className: \"tool__label\",\n        children: /*#__PURE__*/_jsxDEV(\"img\", {\n          src: select,\n          alt: \"select icon\",\n          className: \"toolbar__icon\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 404,\n          columnNumber: 5\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 400,\n        columnNumber: 4\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"radio\",\n        id: \"delete\",\n        checked: tool === \"delete\",\n        onChange: () => setTool(\"delete\"),\n        className: \"tool\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 406,\n        columnNumber: 4\n      }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n        htmlFor: \"delete\",\n        className: \"tool__label\",\n        children: /*#__PURE__*/_jsxDEV(\"img\", {\n          src: deleteicon,\n          alt: \"delete icon\",\n          className: \"toolbar__icon\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 417,\n          columnNumber: 5\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 413,\n        columnNumber: 4\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        onClick: undo,\n        className: \"click\",\n        children: /*#__PURE__*/_jsxDEV(\"img\", {\n          src: undoIcon,\n          alt: \"undo\",\n          className: \"toolbar__icon\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 422,\n          columnNumber: 5\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 421,\n        columnNumber: 4\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        onClick: redo,\n        className: \"click\",\n        children: /*#__PURE__*/_jsxDEV(\"img\", {\n          src: redoIcon,\n          alt: \"redo\",\n          className: \"toolbar__icon\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 425,\n          columnNumber: 5\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 424,\n        columnNumber: 4\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 337,\n      columnNumber: 3\n    }, this), /*#__PURE__*/_jsxDEV(\"nav\", {\n      className: \"nav\",\n      children: [/*#__PURE__*/_jsxDEV(Link, {\n        to: \"/\",\n        children: /*#__PURE__*/_jsxDEV(\"img\", {\n          src: home,\n          alt: \"home icon\",\n          className: \"nav__icon click\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 434,\n          columnNumber: 5\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 433,\n        columnNumber: 4\n      }, this), /*#__PURE__*/_jsxDEV(Link, {\n        to: \"/about\",\n        children: /*#__PURE__*/_jsxDEV(\"img\", {\n          src: about,\n          alt: \"about icon\",\n          className: \"nav__icon click\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 437,\n          columnNumber: 5\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 436,\n        columnNumber: 4\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 432,\n      columnNumber: 3\n    }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n      id: \"canvas\",\n      width: window.innerWidth,\n      height: window.innerHeight,\n      onMouseDown: handleMouseDown,\n      onMouseMove: handleMouseMove,\n      onMouseUp: handleMouseUp,\n      children: \"Canvas\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 442,\n      columnNumber: 3\n    }, this)]\n  }, void 0, true);\n};\n\n_s2(CanvasPage, \"nKG889UzYbzwLY3ibTSWOtQ+zZQ=\", false, function () {\n  return [useHistory];\n});\n\n_c = CanvasPage;\nexport default CanvasPage;\n\nvar _c;\n\n$RefreshReg$(_c, \"CanvasPage\");","map":{"version":3,"sources":["/Users/alysurr/Documents/Capstone/drawllab/src/pages/CanvasPage/CanvasPage.jsx"],"names":["React","useEffect","useLayoutEffect","useState","Link","rough","getStroke","home","about","deleteicon","generator","createElement","id","x1","y1","x2","y2","type","roughElement","line","roughness","bowing","strokeWidth","rectangle","points","x","y","Error","nearPoint","name","Math","abs","onLine","maxDistance","a","b","c","offset","distance","positionInElement","element","on","start","end","topLeft","topRight","bottomLeft","bottomRight","inside","betweenAnyPoint","some","point","index","nextPoint","sqrt","pow","getElementAtPosition","elements","map","position","find","adjustElementCoordinates","minX","min","maxX","max","minY","maxY","cursorForPosition","resizedCoordinates","clientX","clientY","coordinates","useHistory","initialState","setIndex","history","setHistory","setState","action","overwrite","newState","historyCopy","updatedState","slice","prevState","undo","redo","length","getSvgPathFromStroke","stroke","d","reduce","acc","x0","y0","i","arr","push","join","drawElement","roughCanvas","context","draw","size","thinning","smoothing","streamline","fill","Path2D","adjustmentRequired","includes","CanvasPage","setElements","setAction","tool","setTool","selectedElement","setSelectedElement","canvas","document","getElementById","getContext","clearRect","width","height","forEach","undoRedoFunction","e","metaKey","ctrlKey","key","shiftKey","addEventListener","removeEventListener","updateElement","elementsCopy","handleMouseDown","xOffsets","yOffsets","offsetX","offsetY","handleMouseMove","target","style","cursor","newPoints","_","newX1","newY1","handleMouseUp","colorpicker","paintbrush","square","select","undoIcon","redoIcon","window","innerWidth","innerHeight"],"mappings":"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","sourcesContent":["import './CanvasPage.scss';\nimport React, { useEffect, useLayoutEffect, useState } from 'react';\nimport { Link } from 'react-router-dom';\nimport rough from 'roughjs/bundled/rough.esm';\nimport { getStroke } from 'perfect-freehand';\n\n// ----- icons for toolbar -----\n\nimport paintbrush from '../../assets/images/paintbrush.svg';\nimport line from '../../assets/images/draw-line.svg';\nimport square from '../../assets/images/rectangle.svg';\nimport select from '../../assets/images/select.svg';\nimport home from '../../assets/images/home.png';\nimport about from '../../assets/images/about.png';\nimport deleteicon from '../../assets/images/delete.png';\nimport colorpicker from '../../assets/images/color-picker.svg';\nimport undoIcon from '../../assets/images/undo.svg'\nimport redoIcon from '../../assets/images/redo.svg'\n\n// ----- Functionality for Tools -----\n\nconst generator = rough.generator();\n\nconst createElement = (id, x1, y1, x2, y2, type) => {\n  switch (type) {\n    case \"line\":\n    case \"rectangle\":\n      const roughElement =\n        type === \"line\"\n\t\t\t  ? generator.line(x1, y1, x2, y2, { roughness: 1.25, bowing: 2, strokeWidth: 2})\n          : generator.rectangle(x1, y1, x2 - x1, y2 - y1, {roughness: 1.25, bowing: 2, strokeWidth: 3});\n      return { id, x1, y1, x2, y2, type, roughElement };\n    case \"paintbrush\":\n      return { id, type, points: [{ x: x1, y: y1 }] };\n    default:\n      throw new Error(`unrecognized: ${type}`);\n  }\n};\n\nconst nearPoint = (x, y, x1, y1, name) => {\n  return Math.abs(x - x1) < 5 && Math.abs(y - y1) < 5 ? name : null;\n};\n\nconst onLine = (x1, y1, x2, y2, x, y, maxDistance = 1) => {\n  const a = { x: x1, y: y1 };\n  const b = { x: x2, y: y2 };\n  const c = { x, y };\n  const offset = distance(a, b) - (distance(a, c) + distance(b, c));\n  return Math.abs(offset) < maxDistance ? \"inside\" : null;\n};\n\nconst positionInElement = (x, y, element) => {\n  const { type, x1, x2, y1, y2 } = element;\n  switch (type) {\n    case \"line\":\n      const on = onLine(x1, y1, x2, y2, x, y);\n      const start = nearPoint(x, y, x1, y1, \"start\");\n      const end = nearPoint(x, y, x2, y2, \"end\");\n      return start || end || on;\n    case \"rectangle\":\n      const topLeft = nearPoint(x, y, x1, y1, \"tl\");\n      const topRight = nearPoint(x, y, x2, y1, \"tr\");\n      const bottomLeft = nearPoint(x, y, x1, y2, \"bl\");\n      const bottomRight = nearPoint(x, y, x2, y2, \"br\");\n      const inside = x >= x1 && x <= x2 && y >= y1 && y <= y2 ? \"inside\" : null;\n      return topLeft || topRight || bottomLeft || bottomRight || inside;\n    case \"paintbrush\":\n      const betweenAnyPoint = element.points.some((point, index) => {\n        const nextPoint = element.points[index + 1];\n        if (!nextPoint) return false;\n        return onLine(point.x, point.y, nextPoint.x, nextPoint.y, x, y, 5) != null;\n      });\n      return betweenAnyPoint ? \"inside\" : null;\n    default:\n      throw new Error(`Type not recognised: ${type}`);\n  }\n};\n\nconst distance = (a, b) => Math.sqrt(Math.pow(a.x - b.x, 2) + Math.pow(a.y - b.y, 2));\n\nconst getElementAtPosition = (x, y, elements) => {\n  return elements\n    .map(element => ({ ...element, position: positionInElement(x, y, element) }))\n    .find(element => element.position !== null);\n};\n\nconst adjustElementCoordinates = element => {\n  const { type, x1, y1, x2, y2 } = element;\n  if (type === \"rectangle\") {\n    const minX = Math.min(x1, x2);\n    const maxX = Math.max(x1, x2);\n    const minY = Math.min(y1, y2);\n    const maxY = Math.max(y1, y2);\n    return { x1: minX, y1: minY, x2: maxX, y2: maxY };\n  } else {\n    if (x1 < x2 || (x1 === x2 && y1 < y2)) {\n      return { x1, y1, x2, y2 };\n    } else {\n      return { x1: x2, y1: y2, x2: x1, y2: y1 };\n    }\n  }\n};\n\nconst cursorForPosition = position => {\n  switch (position) {\n    case \"tl\":\n    case \"br\":\n    case \"start\":\n    case \"end\":\n      return \"nwse-resize\";\n    case \"tr\":\n    case \"bl\":\n      return \"nesw-resize\";\n    default:\n      return \"move\";\n  }\n};\n\nconst resizedCoordinates = (clientX, clientY, position, coordinates) => {\n  const { x1, y1, x2, y2 } = coordinates;\n  switch (position) {\n    case \"tl\":\n    case \"start\":\n      return { x1: clientX, y1: clientY, x2, y2 };\n    case \"tr\":\n      return { x1, y1: clientY, x2: clientX, y2 };\n    case \"bl\":\n      return { x1: clientX, y1, x2, y2: clientY };\n    case \"br\":\n    case \"end\":\n      return { x1, y1, x2: clientX, y2: clientY };\n    default:\n      return null; //should not really get here...\n  }\n};\n\nconst useHistory = initialState => {\n  const [index, setIndex] = useState(0);\n  const [history, setHistory] = useState([initialState]);\n\n  const setState = (action, overwrite = false) => {\n    const newState = typeof action === \"function\" ? action(history[index]) : action;\n    if (overwrite) {\n      const historyCopy = [...history];\n      historyCopy[index] = newState;\n      setHistory(historyCopy);\n    } else {\n      const updatedState = [...history].slice(0, index + 1);\n      setHistory([...updatedState, newState]);\n      setIndex(prevState => prevState + 1);\n    }\n  };\n\n  const undo = () => index > 0 && setIndex(prevState => prevState - 1);\n  const redo = () => index < history.length - 1 && setIndex(prevState => prevState + 1);\n\n  return [history[index], setState, undo, redo];\n};\n\nconst getSvgPathFromStroke = stroke => {\n  if (!stroke.length) return \"\";\n\n  const d = stroke.reduce(\n    (acc, [x0, y0], i, arr) => {\n      const [x1, y1] = arr[(i + 1) % arr.length];\n      acc.push(x0, y0, (x0 + x1) / 2, (y0 + y1) / 2);\n      return acc;\n    },\n    [\"M\", ...stroke[0], \"Q\"]\n  );\n\n  d.push(\"Z\");\n  return d.join(\" \");\n};\n\nconst drawElement = (roughCanvas, context, element) => {\n  switch (element.type) {\n    case \"line\":\n    case \"rectangle\":\n      roughCanvas.draw(element.roughElement);\n      break;\n    case \"paintbrush\":\n      const stroke = getSvgPathFromStroke(getStroke(element.points, {\n\t\tsize: 8,\n\t\tthinning: 0.5,\n\t\tsmoothing: 0.5,\n\t\tstreamline: 0.5,\n\t  }));\n      context.fill(new Path2D(stroke));\n      break;\n    default:\n      throw new Error(`unrecognised: ${element.type}`);\n  }\n};\n\nconst adjustmentRequired = type => [\"line\", \"rectangle\"].includes(type);\n\nconst CanvasPage = () => {\n\n  const [elements, setElements, undo, redo] = useHistory([]);\n  const [action, setAction] = useState(\"none\");\n  const [tool, setTool] = useState(\"paintbrush\");\n  const [selectedElement, setSelectedElement] = useState(null);\n\n  useLayoutEffect(() => {\n    const canvas = document.getElementById(\"canvas\");\n    const context = canvas.getContext(\"2d\");\n    context.clearRect(0, 0, canvas.width, canvas.height);\n\n    const roughCanvas = rough.canvas(canvas);\n\n    elements.forEach(element => drawElement(roughCanvas, context, element));\n  }, [elements]);\n\n  useEffect(() => {\n    const undoRedoFunction = e => {\n      if ((e.metaKey || e.ctrlKey) && e.key === \"z\") {\n        if (e.shiftKey) {\n          redo();\n        } else {\n          undo();\n        }\n      }\n    };\n\n    document.addEventListener(\"keydown\", undoRedoFunction);\n    return () => {\n      document.removeEventListener(\"keydown\", undoRedoFunction);\n    };\n  }, [undo, redo]);\n\n  const updateElement = (id, x1, y1, x2, y2, type) => {\n    const elementsCopy = [...elements];\n\n    switch (type) {\n      case \"line\":\n      case \"rectangle\":\n        elementsCopy[id] = createElement(id, x1, y1, x2, y2, type);\n        break;\n      case \"paintbrush\":\n        elementsCopy[id].points = [...elementsCopy[id].points, { x: x2, y: y2 }];\n        break;\n      default:\n        throw new Error(`unrecognised: ${type}`);\n    }\n\n    setElements(elementsCopy, true);\n  };\n\n  const handleMouseDown = e => {\n    const { clientX, clientY } = e;\n    if (tool === \"select\") {\n      const element = getElementAtPosition(clientX, clientY, elements);\n      if (element) {\n        if (element.type === \"paintbrush\") {\n          const xOffsets = element.points.map(point => clientX - point.x);\n          const yOffsets = element.points.map(point => clientY - point.y);\n          setSelectedElement({ ...element, xOffsets, yOffsets });\n        } else {\n          const offsetX = clientX - element.x1;\n          const offsetY = clientY - element.y1;\n          setSelectedElement({ ...element, offsetX, offsetY });\n        }\n        setElements(prevState => prevState);\n\n        if (element.position === \"inside\") {\n          setAction(\"moving\");\n        } else {\n          setAction(\"resizing\");\n        }\n      }\n    } else {\n      const id = elements.length;\n      const element = createElement(id, clientX, clientY, clientX, clientY, tool);\n      setElements(prevState => [...prevState, element]);\n      setSelectedElement(element);\n\n      setAction(\"drawing\");\n    }\n  };\n\n  const handleMouseMove = e => {\n    const { clientX, clientY } = e;\n\n    if (tool === \"select\") {\n      const element = getElementAtPosition(clientX, clientY, elements);\n      e.target.style.cursor = element ? cursorForPosition(element.position) : \"default\";\n    }\n\n    if (action === \"drawing\") {\n      const index = elements.length - 1;\n      const { x1, y1 } = elements[index];\n      updateElement(index, x1, y1, clientX, clientY, tool);\n    } else if (action === \"moving\") {\n      if (selectedElement.type === \"paintbrush\") {\n        const newPoints = selectedElement.points.map((_, index) => ({\n          x: clientX - selectedElement.xOffsets[index],\n          y: clientY - selectedElement.yOffsets[index],\n        }));\n        const elementsCopy = [...elements];\n        elementsCopy[selectedElement.id] = {\n          ...elementsCopy[selectedElement.id],\n          points: newPoints,\n        };\n        setElements(elementsCopy, true);\n      } else {\n        const { id, x1, x2, y1, y2, type, offsetX, offsetY } = selectedElement;\n        const width = x2 - x1;\n        const height = y2 - y1;\n        const newX1 = clientX - offsetX;\n        const newY1 = clientY - offsetY;\n        updateElement(id, newX1, newY1, newX1 + width, newY1 + height, type);\n      }\n    } else if (action === \"resizing\") {\n      const { id, type, position, ...coordinates } = selectedElement;\n      const { x1, y1, x2, y2 } = resizedCoordinates(clientX, clientY, position, coordinates);\n      updateElement(id, x1, y1, x2, y2, type);\n    }\n  };\n\n  const handleMouseUp = () => {\n    if (selectedElement) {\n      const index = selectedElement.id;\n      const { id, type } = elements[index];\n      if ((action === \"drawing\" || action === \"resizing\") && adjustmentRequired(type)) {\n        const { x1, y1, x2, y2 } = adjustElementCoordinates(elements[index]);\n        updateElement(id, x1, y1, x2, y2, type);\n      }\n    }\n    setAction(\"none\");\n    setSelectedElement(null);\n  };\n\n  return (\n\t<>\n\t\t{/* Toolbar Component */}\n\t\t<div className=\"toolbar\">\n\t\t\t<input\n\t\t\t\ttype=\"radio\"\n\t\t\t\tid=\"colorpick\"\n\t\t\t\tchecked={tool === \"colorpick\"}\n\t\t\t\tonChange={() => setTool(\"colorpick\")}\n\t\t\t\tclassName=\"tool\"\n\t\t\t/>\n\t\t\t<label\n\t\t\t\thtmlFor=\"colorpick\"\n\t\t\t\tclassName=\"tool__label\"\n\t\t\t>\n\t\t\t<div className=\"tool__div\">\n\t\t\t\t<img src={colorpicker} alt=\"colorpick icon\" className=\"toolbar__icon\"/>\n\t\t\t</div>\n\t\t\t</label>\n\t\t\t\n\t\t\t<input\n\t\t\t\ttype=\"radio\"\n\t\t\t\tid=\"paintbrush\"\n\t\t\t\tchecked={tool === \"paintbrush\"}\n\t\t\t\tonChange={() => setTool(\"paintbrush\")}\n\t\t\t\tclassName=\"tool\"\n\t\t\t/>\n\t\t\t<label\n\t\t\t\thtmlFor=\"paintbrush\"\n\t\t\t\tclassName=\"tool__label\"\n\t\t\t>\n\t\t\t\t<img src={paintbrush} alt=\"paintbrush icon\" className=\"toolbar__icon\"/>\n\t\t\t</label>\n\t\t\t<input\n\t\t\t\ttype=\"radio\"\n\t\t\t\tid=\"line\"\n\t\t\t\tchecked={tool === \"line\"}\n\t\t\t\tonChange={() => setTool(\"line\")}\n\t\t\t\tclassName=\"tool\"\n\t\t\t/>\n\t\t\t<label\n\t\t\t\thtmlFor=\"line\"\n\t\t\t\tclassName=\"tool__label\"\n\t\t\t>\n\t\t\t\t<img src={line} alt=\"line icon\" className=\"toolbar__icon\"/>\n\t\t\t</label>\n\t\t\t<input\n\t\t\t\ttype=\"radio\"\n\t\t\t\tid=\"rectangle\"\n\t\t\t\tchecked={tool === \"rectangle\"}\n\t\t\t\tonChange={() => setTool(\"rectangle\")}\n\t\t\t\tclassName=\"tool\"\n\t\t\t/>\n\t\t\t<label\n\t\t\t\thtmlFor=\"rectangle\"\n\t\t\t\tclassName=\"tool__label\"\n\t\t\t>\n\t\t\t\t<img src={square} alt=\"rectangle icon\" className=\"toolbar__icon\"/>\n\t\t\t</label>\n\t\t\t<input\n\t\t\t\ttype=\"radio\"\n\t\t\t\tid=\"select\"\n\t\t\t\tchecked={tool === \"select\"}\n\t\t\t\tonChange={() => setTool(\"select\")}\n\t\t\t\tclassName=\"tool\"\n\t\t\t/>\n\t\t\t<label\n\t\t\t\thtmlFor=\"select\"\n\t\t\t\tclassName=\"tool__label\"\n\t\t\t>\n\t\t\t\t<img src={select} alt=\"select icon\" className=\"toolbar__icon\"/>\n\t\t\t</label>\n\t\t\t<input\n\t\t\t\ttype=\"radio\"\n\t\t\t\tid=\"delete\"\n\t\t\t\tchecked={tool === \"delete\"}\n\t\t\t\tonChange={() => setTool(\"delete\")}\n\t\t\t\tclassName=\"tool\"\n\t\t\t/>\n\t\t\t<label\n\t\t\t\thtmlFor=\"delete\"\n\t\t\t\tclassName=\"tool__label\"\n\t\t\t>\n\t\t\t\t<img src={deleteicon} alt=\"delete icon\" className=\"toolbar__icon\"/>\n\t\t\t</label>\n\n\t\t{/* Undo/Redo Buttons should stay at bottom of list */}\n\t\t\t<div onClick={undo} className=\"click\">\n\t\t\t\t<img src={undoIcon} alt=\"undo\" className=\"toolbar__icon\" />\n\t\t\t</div>\n\t\t\t<div onClick={redo} className=\"click\">\n\t\t\t\t<img src={redoIcon} alt=\"redo\" className=\"toolbar__icon\" />\n\t\t\t</div>\n\n\t\t</div>\n\n\t\t{/* Nav Bar Component */}\n\n\t\t<nav className=\"nav\">\n\t\t\t<Link to=\"/\">\n\t\t\t\t<img src={home} alt=\"home icon\" className=\"nav__icon click\"/>\n\t\t\t</Link>\n\t\t\t<Link to=\"/about\">\n\t\t\t\t<img src={about} alt=\"about icon\" className=\"nav__icon click\"/>\n\t\t\t</Link>\n\t\t</nav>\n\n\t\t{/* Canvas Component */}\n\t\t<canvas\n\t\t\tid=\"canvas\"\n\t\t\twidth={window.innerWidth}\n\t\t\theight={window.innerHeight}\n\t\t\tonMouseDown={handleMouseDown}\n\t\t\tonMouseMove={handleMouseMove}\n\t\t\tonMouseUp={handleMouseUp}\n\t\t>\n\t\t\tCanvas\n\t\t</canvas>\n    </>\n  )\n}\n\nexport default CanvasPage;\n"]},"metadata":{},"sourceType":"module"}