import e from"../../external/@babel/runtime/helpers/esm/classCallCheck.es.js";import t from"../../external/@babel/runtime/helpers/esm/createClass.es.js";import r from"../../external/@babel/runtime/helpers/esm/inherits.es.js";import l from"../../external/@babel/runtime/helpers/esm/possibleConstructorReturn.es.js";import o from"../../external/@babel/runtime/helpers/esm/getPrototypeOf.es.js";import n from"react";import s from"classnames";import{copyComponentRef as c,findChildByType as i}from"../../utility/react/react.es.js";import{isEqual as a}from"../../utility/object/object.es.js";import{normalizeScrollPosition as p}from"./Scrollable.utils.es.js";import m from"../../tools/ResizeObserver/ResizeObserver.es.js";import u from"./components/VerticalScrollbar/VerticalScrollbar.es.js";import f from"./components/VerticalScrollbar/VerticalScrollbar.placeholder.es.js";import h from"./components/HorizontalScrollbar/HorizontalScrollbar.es.js";import d from"./components/HorizontalScrollbar/HorizontalScrollbar.placeholder.es.js";import"./components/Shadow/Shadow.es.js";import v from"./Scrollable.context.es.js";import{propTypes as b,defaultProps as y}from"./Scrollable.props.es.js";import{SCROLLING_CLASS_REMOVAL_DELAY as S}from"./Scrollable.constants.es.js";import"./Scrollable.es2.js";function j(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=o(e);if(t){var s=o(this).constructor;r=Reflect.construct(n,arguments,s)}else r=n.apply(this,arguments);return l(this,r)}}var g=function(l){r(b,l);var o=j(b);function b(t){var r;return e(this,b),(r=o.call(this,t)).handleOnScroll=function(e){var t=r.container.current;r.updateScrollbars(),r.props.onScroll(r.event.next),e.target===t&&(t.parentElement.classList.add("scrolling"),clearTimeout(r.timeout),r.timeout=setTimeout((function(){t.parentElement.classList.remove("scrolling")}),S))},r.getEvent=function(){if(!r.container.current)return{};var e=r.container.current,t=e.clientHeight,l=e.clientWidth,o=e.scrollTop,n=e.scrollLeft,s=e.scrollHeight,c=e.scrollWidth,i=Math.ceil(o),a=Math.ceil(n);return{top:p(s,t,i),left:p(c,l,a),scrollTop:i,scrollLeft:a,scrollHeight:s,scrollWidth:c,clientHeight:t,clientWidth:l}},r.updateScrollbars=function(){if(r.event.next=r.getEvent(),!a(r.event.prev,r.event.next)){var e=r.container.current.parentElement;r.props.onUpdate(r.event.next);var t=r.event.next.clientHeight/r.event.next.scrollHeight,l=r.event.next.clientWidth/r.event.next.scrollWidth;t<1?e.classList.add("vertically-scrollable"):e.classList.remove("vertically-scrollable"),l<1?e.classList.add("horizontally-scrollable"):e.classList.remove("horizontally-scrollable"),e.style.setProperty("--scrollable-vertical-ratio",t),e.style.setProperty("--scrollable-horizontal-ratio",l),e.style.setProperty("--scrollable-scroll-top",r.event.next.top),e.style.setProperty("--scrollable-scroll-left",r.event.next.left)}r.event.prev=r.event.next},r.getElementProps=function(){var e=r.props.element;return{className:s("scrollbar-inner",e.props.className),ref:c(e.ref,r.container),onScroll:r.handleOnScroll}},r.handleOnTransitionEnd=function(e){"height"!==e.propertyName&&"width"!==e.propertyName||r.updateScrollbars()},r.container=n.createRef(),r.ctx={container:r.container},r.event={prev:{},next:{}},r}return t(b,[{key:"getSnapshotBeforeUpdate",value:function(){var e=this.container.current;return{scrollTop:e.scrollTop,scrollLeft:e.scrollLeft}}},{key:"componentDidMount",value:function(){this.updateScrollbars()}},{key:"componentDidUpdate",value:function(e,t,r){var l=r.scrollTop,o=r.scrollLeft;this.props.scrollOnDOMChange||(this.container.current.scrollTop=l,this.container.current.scrollLeft=o),this.updateScrollbars()}},{key:"render",value:function(){var e=this.props,t=e.children,r=e.style,l=e.element,o=i(t,f),s=i(t,d),c=n.Children.toArray(t).filter((function(e){return![f,d].includes(e.type)}));return n.createElement(m,{onResize:this.updateScrollbars},n.createElement("div",{className:"scrollbar",style:r,onTransitionEnd:this.handleOnTransitionEnd},n.cloneElement(l,this.getElementProps(),c),n.createElement(v.Provider,{value:this.ctx},o?o.props.children:n.createElement(u,null),s?s.props.children:n.createElement(h,null))))}}]),b}(n.PureComponent);g.propTypes=b,g.defaultProps=y;export default g;
