{"ast":null,"code":"var _jsxFileName = \"/Users/alysurr/Documents/Capstone/drawllab/src/pages/CanvasPage/CanvasPage.jsx\",\n    _s = $RefreshSig$();\n\nimport './CanvasPage.scss';\nimport React, { useLayoutEffect, useState, useEffect } from 'react';\nimport { Link } from 'react-router-dom';\nimport rough from 'roughjs/bundled/rough.esm'; // ----- icons for toolbar -----\n\nimport paintbrush from \"../../assets/images/paintbrush.svg\";\nimport line from \"../../assets/images/draw-line.svg\";\nimport square from \"../../assets/images/rectangle.svg\";\nimport selection from \"../../assets/images/select.svg\";\nimport home from '../../assets/images/home.png';\nimport about from '../../assets/images/about.png';\nimport deleteicon from '../../assets/images/delete.png';\nimport colorpicker from \"../../assets/images/color-picker.svg\"; // ----- Functionality for Tools -----\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst generator = rough.generator();\n\nfunction createElement(id, x1, y1, x2, y2, type) {\n  const roughElement = type === \"line\" ? generator.line(x1, y1, x2, y2) : generator.rectangle(x1, y1, x2 - x1, y2 - y1); // generator.circle(80, 120, 50);;\n\n  return {\n    id,\n    x1,\n    y1,\n    x2,\n    y2,\n    type,\n    roughElement\n  };\n}\n\nconst nearPoint = (x, y, x1, y1, name) => {\n  return Math.abs(x - x1) < 5 && Math.abs(y - y1) < 5 ? name : null;\n};\n\nconst onLine = (x1, y1, x2, y2, x, y, maxDistance = 1) => {\n  const a = {\n    x: x1,\n    y: y1\n  };\n  const b = {\n    x: x2,\n    y: y2\n  };\n  const c = {\n    x,\n    y\n  };\n  const offset = distance(a, b) - (distance(a, c) + distance(b, c));\n  return Math.abs(offset) < maxDistance ? \"inside\" : null;\n};\n\nconst isWithinElement = (x, y, element) => {\n  const {\n    type,\n    x1,\n    y1,\n    x2,\n    y2\n  } = element;\n\n  if (type === \"rectangle\") {\n    const topLeft = nearPoint(x, y, x1, y1, \"tl\");\n    const topRight = nearPoint(x, y, x2, y1, \"tr\");\n    const bottomLeft = nearPoint(x, y, x1, y2, \"bl\");\n    const bottomRight = nearPoint(x, y, x2, y2, \"br\");\n    const inside = x >= x1 && x <= x2 && y >= y1 && y <= y2 ? \"inside\" : null;\n    return topLeft || topRight || bottomLeft || bottomRight || inside;\n  } else {\n    const a = {\n      x: x1,\n      y: y1\n    };\n    const b = {\n      x: x2,\n      y: y2\n    };\n    const c = {\n      x,\n      y\n    };\n    const offset = distance(a, b) - (distance(a, c) + distance(b, c));\n    const start = nearPoint(x, y, x1, y1, \"start\");\n    const end = nearPoint(x, y, x2, y2, \"end\");\n    const inside = Math.abs(offset) < 1 ? \"inside\" : null;\n    return start || end || inside;\n  }\n};\n\nconst distance = (a, b) => Math.sqrt(Math.pow(a.x - b.x, 2) + Math.pow(a.y - b.y, 2));\n\nconst getElementAtPosition = (x, y, elements) => {\n  return elements.map(element => ({ ...element,\n    position: isWithinElement(x, y, element)\n  })).find(element => element.position !== null);\n};\n\nconst adjustElementCoordinates = element => {\n  const {\n    type,\n    x1,\n    y1,\n    x2,\n    y2\n  } = element;\n\n  if (type === \"rectangle\") {\n    const minX = Math.min(x1, x2);\n    const maxX = Math.max(x1, x2);\n    const minY = Math.min(y1, y2);\n    const maxY = Math.max(y1, y2);\n    return {\n      x1: minX,\n      y1: minY,\n      x2: maxX,\n      y2: maxY\n    };\n  } else {\n    if (x1 < x2 || x1 === x2 && y1 < y2) {\n      return {\n        x1,\n        y1,\n        x2,\n        y2\n      };\n    } else {\n      return {\n        x1: x2,\n        y1: y2,\n        x2: x1,\n        y2: y1\n      };\n    }\n  }\n};\n\nconst cursorForPosition = position => {\n  switch (position) {\n    case \"tl\":\n    case \"br\":\n    case \"start\":\n    case \"end\":\n      return \"nwse-resize\";\n\n    case \"tr\":\n    case \"bl\":\n      return \"nesw-resize\";\n\n    default:\n      return \"move\";\n  }\n};\n\nconst resizedCoordinates = (clientX, clientY, position, coordinates) => {\n  const {\n    x1,\n    y1,\n    x2,\n    y2\n  } = coordinates;\n\n  switch (position) {\n    case \"tl\":\n    case \"start\":\n      return {\n        x1: clientX,\n        y1: clientY,\n        x2,\n        y2\n      };\n\n    case \"tr\":\n      return {\n        x1,\n        y1: clientY,\n        x2: clientX,\n        y2\n      };\n\n    case \"bl\":\n      return {\n        x1: clientX,\n        y1,\n        x2,\n        y2: clientY\n      };\n\n    case \"br\":\n    case \"end\":\n      return {\n        x1,\n        y1,\n        x2: clientX,\n        y2: clientY\n      };\n\n    default:\n      return null;\n  }\n}; // ----- PAGE -----\n\n\nconst CanvasPage = () => {\n  _s();\n\n  // ----- Set State Hooks -----\n  const [elements, setElements] = useState([]);\n  const [action, setAction] = useState(\"none\");\n  const [tool, setTool] = useState(\"line\");\n  const [selectedElement, setSelectedElement] = useState(null); // Dark/Light Mode\n\n  const [darkTheme, setDarkTheme] = useState(getDefaultTheme());\n  useEffect(() => {\n    localStorage.setItem('dark', JSON.stringify(darkTheme));\n  }, [darkTheme]);\n\n  function getDefaultTheme() {\n    const selectedTheme = JSON.parse(localStorage.getItem('dark'));\n    return selectedTheme || false;\n  }\n\n  useLayoutEffect(() => {\n    const canvas = document.getElementById(\"canvas\");\n    const context = canvas.getContext(\"2d\"); // clears canvas on refresh \n\n    context.clearRect(0, 0, canvas.width, canvas.height);\n    const roughCanvas = rough.canvas(canvas);\n    elements.forEach(({\n      roughElement\n    }) => roughCanvas.draw(roughElement));\n  }, [elements]);\n\n  const updateElement = (id, x1, y1, x2, y2, type) => {\n    const updatedElement = createElement(id, x1, y1, x2, y2, type);\n    const elementsCopy = [...elements];\n    elementsCopy[id] = updatedElement;\n    setElements(elementsCopy);\n  };\n\n  const handleMouseDown = e => {\n    const {\n      clientX,\n      clientY\n    } = e;\n\n    if (tool === \"select\") {\n      const element = getElementAtPosition(clientX, clientY, elements);\n\n      if (element) {\n        const offsetX = clientX - element.x1;\n        const offsetY = clientY - element.y1;\n        setSelectedElement({ ...element,\n          offsetX,\n          offsetY\n        });\n\n        if (element.position === \"inside\") {\n          setAction(\"moving\");\n        } else {\n          setAction(\"resizing\");\n        }\n      }\n    } else {\n      const id = elements.length;\n      const element = createElement(id, clientX, clientY, clientX, clientY, tool);\n      setElements(prevState => [...prevState, element]);\n      setAction(\"drawing\");\n    }\n  };\n\n  const handleMouseMove = e => {\n    const {\n      clientX,\n      clientY\n    } = e;\n\n    if (tool === \"select\") {\n      const element = getElementAtPosition(clientX, clientY, elements);\n      e.target.style.cursor = element ? cursorForPosition(element.position) : \"default\";\n    }\n\n    if (action === \"drawing\") {\n      const index = elements.length - 1;\n      const {\n        x1,\n        y1\n      } = elements[index];\n      updateElement(index, x1, y1, clientX, clientY, tool);\n    } else if (action === \"moving\") {\n      const {\n        id,\n        x1,\n        y1,\n        x2,\n        y2,\n        type,\n        offsetX,\n        offsetY\n      } = selectedElement;\n      const width = x2 - x1;\n      const height = y2 - y1;\n      const nexX1 = clientX - offsetX;\n      const nexY1 = clientY - offsetY;\n      updateElement(id, nexX1, nexY1, nexX1 + width, nexY1 + height, tool);\n    } else if (action === \"resizing\") {\n      const {\n        id,\n        type,\n        position,\n        ...coordinates\n      } = selectedElement;\n      const {\n        x1,\n        y1,\n        x2,\n        y2\n      } = resizedCoordinates(clientX, clientY, position, coordinates);\n      updateElement(id, x1, y1, x2, y2, type);\n    }\n  };\n\n  const handleMouseUp = () => {\n    const index = elements.length - 1;\n    const {\n      id,\n      type\n    } = elements[index];\n\n    if (action === \"drawing\") {\n      const {\n        x1,\n        y1,\n        x2,\n        y2\n      } = adjustElementCoordinates(elements[index]);\n      updateElement(id, x1, y1, x2, y2, type);\n    }\n\n    setAction(\"none\");\n    setSelectedElement(null);\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: darkTheme ? 'dark-theme' : 'light-theme',\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"toolbar\",\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"radio\",\n          id: \"colorpick\",\n          checked: tool === \"colorpick\",\n          onChange: () => setTool(\"colorpick\"),\n          className: \"tool\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 228,\n          columnNumber: 5\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          htmlFor: \"colorpick\",\n          className: \"tool__label\",\n          children: /*#__PURE__*/_jsxDEV(\"img\", {\n            src: colorpicker,\n            alt: \"colorpick icon\",\n            className: \"toolbar__icon\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 239,\n            columnNumber: 6\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 235,\n          columnNumber: 5\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"radio\",\n          id: \"paintbrush\",\n          checked: tool === \"paintbrush\",\n          onChange: () => setTool(\"paintbrush\"),\n          className: \"tool\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 241,\n          columnNumber: 5\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          htmlFor: \"paintbrush\",\n          className: \"tool__label\",\n          children: /*#__PURE__*/_jsxDEV(\"img\", {\n            src: paintbrush,\n            alt: \"paintbrush icon\",\n            className: \"toolbar__icon\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 252,\n            columnNumber: 6\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 248,\n          columnNumber: 5\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"radio\",\n          id: \"line\",\n          checked: tool === \"line\",\n          onChange: () => setTool(\"line\"),\n          className: \"tool\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 254,\n          columnNumber: 5\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          htmlFor: \"line\",\n          className: \"tool__label\",\n          children: /*#__PURE__*/_jsxDEV(\"img\", {\n            src: line,\n            alt: \"line icon\",\n            className: \"toolbar__icon\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 265,\n            columnNumber: 6\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 261,\n          columnNumber: 5\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"radio\",\n          id: \"rectangle\",\n          checked: tool === \"rectangle\",\n          onChange: () => setTool(\"rectangle\"),\n          className: \"tool\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 267,\n          columnNumber: 5\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          htmlFor: \"rectangle\",\n          className: \"tool__label\",\n          children: /*#__PURE__*/_jsxDEV(\"img\", {\n            src: square,\n            alt: \"rectangle icon\",\n            className: \"toolbar__icon\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 278,\n            columnNumber: 6\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 274,\n          columnNumber: 5\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"radio\",\n          id: \"select\",\n          checked: tool === \"select\",\n          onChange: () => setTool(\"select\"),\n          className: \"tool\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 280,\n          columnNumber: 5\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          htmlFor: \"select\",\n          className: \"tool__label\",\n          children: /*#__PURE__*/_jsxDEV(\"img\", {\n            src: selection,\n            alt: \"selection icon\",\n            className: \"toolbar__icon\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 291,\n            columnNumber: 6\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 287,\n          columnNumber: 5\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"radio\",\n          id: \"delete\",\n          checked: tool === \"delete\",\n          onChange: () => setTool(\"delete\"),\n          className: \"tool\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 293,\n          columnNumber: 5\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          htmlFor: \"delete\",\n          className: \"tool__label\",\n          children: /*#__PURE__*/_jsxDEV(\"img\", {\n            src: deleteicon,\n            alt: \"delete icon\",\n            className: \"toolbar__icon\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 304,\n            columnNumber: 6\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 300,\n          columnNumber: 5\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 227,\n        columnNumber: 4\n      }, this), /*#__PURE__*/_jsxDEV(\"nav\", {\n        className: \"nav\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => setDarkTheme(prevTheme => !prevTheme),\n          children: \"Toggle Theme\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 311,\n          columnNumber: 5\n        }, this), /*#__PURE__*/_jsxDEV(Link, {\n          to: \"/\",\n          children: /*#__PURE__*/_jsxDEV(\"img\", {\n            src: home,\n            alt: \"home icon\",\n            className: \"nav__icon\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 315,\n            columnNumber: 6\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 314,\n          columnNumber: 5\n        }, this), /*#__PURE__*/_jsxDEV(Link, {\n          to: \"/about\",\n          children: /*#__PURE__*/_jsxDEV(\"img\", {\n            src: about,\n            alt: \"about icon\",\n            className: \"nav__icon\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 318,\n            columnNumber: 6\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 317,\n          columnNumber: 5\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 310,\n        columnNumber: 4\n      }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n        id: \"canvas\",\n        width: window.innerWidth,\n        height: window.innerHeight,\n        onMouseDown: handleMouseDown,\n        onMouseMove: handleMouseMove,\n        onMouseUp: handleMouseUp,\n        children: \"Canvas\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 325,\n        columnNumber: 7\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 225,\n      columnNumber: 3\n    }, this)\n  }, void 0, false);\n};\n\n_s(CanvasPage, \"wZKSKb0Pp+NXLEO4WyBCi6YKx5c=\");\n\n_c = CanvasPage;\nexport default CanvasPage;\n\nvar _c;\n\n$RefreshReg$(_c, \"CanvasPage\");","map":{"version":3,"sources":["/Users/alysurr/Documents/Capstone/drawllab/src/pages/CanvasPage/CanvasPage.jsx"],"names":["React","useLayoutEffect","useState","useEffect","Link","rough","home","about","deleteicon","generator","createElement","id","x1","y1","x2","y2","type","roughElement","line","rectangle","nearPoint","x","y","name","Math","abs","onLine","maxDistance","a","b","c","offset","distance","isWithinElement","element","topLeft","topRight","bottomLeft","bottomRight","inside","start","end","sqrt","pow","getElementAtPosition","elements","map","position","find","adjustElementCoordinates","minX","min","maxX","max","minY","maxY","cursorForPosition","resizedCoordinates","clientX","clientY","coordinates","CanvasPage","setElements","action","setAction","tool","setTool","selectedElement","setSelectedElement","darkTheme","setDarkTheme","getDefaultTheme","localStorage","setItem","JSON","stringify","selectedTheme","parse","getItem","canvas","document","getElementById","context","getContext","clearRect","width","height","roughCanvas","forEach","draw","updateElement","updatedElement","elementsCopy","handleMouseDown","e","offsetX","offsetY","length","prevState","handleMouseMove","target","style","cursor","index","nexX1","nexY1","handleMouseUp","colorpicker","paintbrush","square","selection","prevTheme","window","innerWidth","innerHeight"],"mappings":"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","sourcesContent":["import './CanvasPage.scss';\nimport React, { useLayoutEffect, useState, useEffect } from 'react';\nimport { Link } from 'react-router-dom';\nimport rough from 'roughjs/bundled/rough.esm';\n\n// ----- icons for toolbar -----\n\nimport paintbrush from '../../assets/images/paintbrush.svg';\nimport line from '../../assets/images/draw-line.svg';\nimport square from '../../assets/images/rectangle.svg';\nimport selection from '../../assets/images/select.svg';\nimport home from '../../assets/images/home.png';\nimport about from '../../assets/images/about.png';\nimport deleteicon from '../../assets/images/delete.png';\nimport colorpicker from '../../assets/images/color-picker.svg';\n\n// ----- Functionality for Tools -----\n\nconst generator = rough.generator();\n\nfunction createElement(id, x1, y1, x2, y2, type) {\n\tconst roughElement =\n\t\ttype === \"line\"\n\t\t\t? generator.line(x1, y1, x2, y2)\n\t\t\t: generator.rectangle(x1, y1, x2 - x1, y2 - y1);\n\t\t// generator.circle(80, 120, 50);;\n  return {id, x1, y1, x2, y2, type, roughElement};\n}\n\nconst nearPoint = (x, y, x1, y1, name) => {\n\treturn Math.abs(x - x1) < 5 && Math.abs(y - y1) < 5 ? name : null;\n  };\n  \n  const onLine = (x1, y1, x2, y2, x, y, maxDistance = 1) => {\n\tconst a = { x: x1, y: y1 };\n\tconst b = { x: x2, y: y2 };\n\tconst c = { x, y };\n\tconst offset = distance(a, b) - (distance(a, c) + distance(b, c));\n\treturn Math.abs(offset) < maxDistance ? \"inside\" : null;\n  };\n\nconst isWithinElement = (x, y, element) => {\n\tconst { type, x1, y1, x2, y2 } = element;\n  if (type === \"rectangle\") {\n\tconst topLeft = nearPoint(x, y, x1, y1, \"tl\");\n\tconst topRight = nearPoint(x, y, x2, y1, \"tr\");\n\tconst bottomLeft = nearPoint(x, y, x1, y2, \"bl\");\n\tconst bottomRight = nearPoint(x, y, x2, y2, \"br\");\n\tconst inside = x >= x1 && x <= x2 && y >= y1 && y <= y2 ? \"inside\" : null;\n\treturn topLeft || topRight || bottomLeft || bottomRight || inside;\n  } else {\n\t\tconst a = { x: x1, y: y1 };\n\t\tconst b = { x: x2, y: y2 };\n\t\tconst c = { x, y };\n\t\tconst offset = distance(a, b) - (distance(a, c) + distance(b, c));\n\t\tconst start = nearPoint(x, y, x1, y1, \"start\");\n\t\tconst end = nearPoint(x, y, x2, y2, \"end\");\n\t\tconst inside = Math.abs(offset) < 1 ? \"inside\" : null;\n\t\treturn start || end || inside;\n  }\n};\n\nconst distance = (a, b) => Math.sqrt(Math.pow(a.x - b.x, 2) + Math.pow(a.y-b.y, 2));\n\nconst getElementAtPosition = (x, y, elements) => {\n\treturn elements\n\t  .map(element => ({ ...element, position: isWithinElement(x, y, element) }))\n\t  .find(element => element.position !== null);\n  };\n\nconst adjustElementCoordinates = element => {\n  const { type, x1, y1, x2, y2 } = element;\n  if (type === \"rectangle\") {\n    const minX = Math.min(x1, x2);\n    const maxX = Math.max(x1, x2);\n    const minY = Math.min(y1, y2);\n    const maxY = Math.max(y1, y2);\n    return { x1: minX, y1: minY, x2: maxX, y2: maxY };\n  } else {\n    if (x1 < x2 || (x1 === x2 && y1 < y2)) {\n      return { x1, y1, x2, y2 };\n    } else {\n      return { x1: x2, y1: y2, x2: x1, y2: y1 };\n    }\n  }\n};\n\nconst cursorForPosition = position => {\n\tswitch (position) {\n\t  case \"tl\":\n\t  case \"br\":\n\t  case \"start\":\n\t  case \"end\":\n\t\treturn \"nwse-resize\";\n\t  case \"tr\":\n\t  case \"bl\":\n\t\treturn \"nesw-resize\";\n\t  default:\n\t\treturn \"move\";\n\t}\n  };\n\n  const resizedCoordinates = (clientX, clientY, position, coordinates) => {\n\tconst { x1, y1, x2, y2 } = coordinates;\n\tswitch (position) {\n\t  case \"tl\":\n\t  case \"start\":\n\t\treturn { x1: clientX, y1: clientY, x2, y2 };\n\t  case \"tr\":\n\t\treturn { x1, y1: clientY, x2: clientX, y2 };\n\t  case \"bl\":\n\t\treturn { x1: clientX, y1, x2, y2: clientY };\n\t  case \"br\":\n\t  case \"end\":\n\t\treturn { x1, y1, x2: clientX, y2: clientY };\n\t  default:\n\t\treturn null; \n\t}\n  };\n  \n\n// ----- PAGE -----\n\nconst CanvasPage = () => {\n\t// ----- Set State Hooks -----\n  \tconst [elements, setElements] = useState([]);\n\tconst [action, setAction] = useState(\"none\");\n\tconst [tool, setTool] = useState(\"line\");\n\tconst [selectedElement, setSelectedElement] = useState(null);\n\n\t// Dark/Light Mode\n\tconst [darkTheme, setDarkTheme] = useState(getDefaultTheme())\n\tuseEffect(() => {\n\t\tlocalStorage.setItem('dark', JSON.stringify(darkTheme))\n\t}, [darkTheme])\n\n\tfunction getDefaultTheme() {\n\t\tconst selectedTheme = JSON.parse(localStorage.getItem('dark'))\n\t\treturn selectedTheme || false\n\t}\n\n  useLayoutEffect(() => {\n    const canvas = document.getElementById(\"canvas\");\n    const context = canvas.getContext(\"2d\");\n\t\t// clears canvas on refresh \n\t\tcontext.clearRect(0, 0, canvas.width, canvas.height);\n\n    const roughCanvas = rough.canvas(canvas);\n\n    elements.forEach(({roughElement}) => roughCanvas.draw(roughElement));\n\t}, [elements]);\n\t\n\tconst updateElement = (id, x1, y1, x2, y2, type) => {\n\t\tconst updatedElement = createElement(id, x1, y1, x2, y2, type);\n\n\t\tconst elementsCopy = [...elements];\n\t\telementsCopy[id] = updatedElement;\n\t\tsetElements(elementsCopy);\n\t};\n  \n\tconst handleMouseDown = (e) => {\n    const { clientX, clientY } = e;\n\t\t\n\t\tif (tool === \"select\") {\n\t\t\tconst element = getElementAtPosition(clientX, clientY, elements)\n\t\t\tif (element) {\n\t\t\t\tconst offsetX = clientX - element.x1;\n\t\t\t\tconst offsetY = clientY - element.y1;\n\t\t\t\tsetSelectedElement({...element, offsetX, offsetY})\n\t\t\t\tif (element.position === \"inside\") {\n\t\t\t\t\tsetAction(\"moving\");\n\t\t\t\t  } else {\n\t\t\t\t\tsetAction(\"resizing\");\n\t\t\t\t  }\n\t\t\t}\n\t\t} else {\n\t\t\tconst id = elements.length;\n\t\t\tconst element = createElement(id, clientX, clientY, clientX, clientY, tool);\n\t\t\tsetElements((prevState) => [...prevState, element]);\n\t\t\t\t\n\t\t\tsetAction(\"drawing\");\n\n\t\t}\n  };\n  \n\tconst handleMouseMove = (e) => {\n\t\tconst { clientX, clientY } = e;\n\t\tif (tool === \"select\") {\n\t\t\tconst element = getElementAtPosition(clientX, clientY, elements);\n\t\t\te.target.style.cursor = element ? cursorForPosition(element.position) : \"default\";\n\t\t  }\n\n\t\tif (action === \"drawing\") {\n\t\t\tconst index = elements.length - 1;\n\t\t\tconst { x1, y1 } = elements[index];\n\t\t\tupdateElement(index, x1, y1, clientX, clientY, tool);\n\t\t} else if (action === \"moving\") {\n\t\t\tconst { id, x1, y1, x2, y2, type, offsetX, offsetY } = selectedElement;\n\t\t\tconst width = x2 - x1;\n\t\t\tconst height = y2 - y1;\n\t\t\tconst nexX1 = clientX - offsetX;\n\t\t\tconst nexY1 = clientY - offsetY;\n\t\t\tupdateElement(id, nexX1, nexY1, nexX1 + width, nexY1 + height, tool);\n\t\t\n\t\t} else if (action === \"resizing\") {\n\t\t\tconst { id, type, position, ...coordinates } = selectedElement;\n\t\t\tconst { x1, y1, x2, y2 } = resizedCoordinates(clientX, clientY, position, coordinates);\n\t\t\tupdateElement(id, x1, y1, x2, y2, type);\n\t\t  }\n  };\n  \n\tconst handleMouseUp = () => {\n\t\tconst index = elements.length - 1;\n\t\tconst { id, type } = elements[index];\n\t\tif (action === \"drawing\") {\n\t\t\tconst { x1, y1, x2, y2 } = adjustElementCoordinates(elements[index]);\n\t\t\tupdateElement(id, x1, y1, x2, y2, type);\n\t\t}\n\t\tsetAction(\"none\");\n\t\tsetSelectedElement(null);\n  };\n\n  return (\n\t  <>\n\t\t<div className={darkTheme ? 'dark-theme' : 'light-theme'}>\n\t\t\t{/* Toolbar Component */}\n\t\t\t<div className=\"toolbar\">\n\t\t\t\t<input\n\t\t\t\t\ttype=\"radio\"\n\t\t\t\t\tid=\"colorpick\"\n\t\t\t\t\tchecked={tool === \"colorpick\"}\n\t\t\t\t\tonChange={() => setTool(\"colorpick\")}\n\t\t\t\t\tclassName=\"tool\"\n\t\t\t\t/>\n\t\t\t\t<label\n\t\t\t\t\thtmlFor=\"colorpick\"\n\t\t\t\t\tclassName=\"tool__label\"\n\t\t\t\t>\n\t\t\t\t\t<img src={colorpicker} alt=\"colorpick icon\" className=\"toolbar__icon\"/>\n\t\t\t\t</label>\n\t\t\t\t<input\n\t\t\t\t\ttype=\"radio\"\n\t\t\t\t\tid=\"paintbrush\"\n\t\t\t\t\tchecked={tool === \"paintbrush\"}\n\t\t\t\t\tonChange={() => setTool(\"paintbrush\")}\n\t\t\t\t\tclassName=\"tool\"\n\t\t\t\t/>\n\t\t\t\t<label\n\t\t\t\t\thtmlFor=\"paintbrush\"\n\t\t\t\t\tclassName=\"tool__label\"\n\t\t\t\t>\n\t\t\t\t\t<img src={paintbrush} alt=\"paintbrush icon\" className=\"toolbar__icon\"/>\n\t\t\t\t</label>\n\t\t\t\t<input\n\t\t\t\t\ttype=\"radio\"\n\t\t\t\t\tid=\"line\"\n\t\t\t\t\tchecked={tool === \"line\"}\n\t\t\t\t\tonChange={() => setTool(\"line\")}\n\t\t\t\t\tclassName=\"tool\"\n\t\t\t\t/>\n\t\t\t\t<label\n\t\t\t\t\thtmlFor=\"line\"\n\t\t\t\t\tclassName=\"tool__label\"\n\t\t\t\t>\n\t\t\t\t\t<img src={line} alt=\"line icon\" className=\"toolbar__icon\"/>\n\t\t\t\t</label>\n\t\t\t\t<input\n\t\t\t\t\ttype=\"radio\"\n\t\t\t\t\tid=\"rectangle\"\n\t\t\t\t\tchecked={tool === \"rectangle\"}\n\t\t\t\t\tonChange={() => setTool(\"rectangle\")}\n\t\t\t\t\tclassName=\"tool\"\n\t\t\t\t/>\n\t\t\t\t<label\n\t\t\t\t\thtmlFor=\"rectangle\"\n\t\t\t\t\tclassName=\"tool__label\"\n\t\t\t\t>\n\t\t\t\t\t<img src={square} alt=\"rectangle icon\" className=\"toolbar__icon\"/>\n\t\t\t\t</label>\n\t\t\t\t<input\n\t\t\t\t\ttype=\"radio\"\n\t\t\t\t\tid=\"select\"\n\t\t\t\t\tchecked={tool === \"select\"}\n\t\t\t\t\tonChange={() => setTool(\"select\")}\n\t\t\t\t\tclassName=\"tool\"\n\t\t\t\t/>\n\t\t\t\t<label\n\t\t\t\t\thtmlFor=\"select\"\n\t\t\t\t\tclassName=\"tool__label\"\n\t\t\t\t>\n\t\t\t\t\t<img src={selection} alt=\"selection icon\" className=\"toolbar__icon\"/>\n\t\t\t\t</label>\n\t\t\t\t<input\n\t\t\t\t\ttype=\"radio\"\n\t\t\t\t\tid=\"delete\"\n\t\t\t\t\tchecked={tool === \"delete\"}\n\t\t\t\t\tonChange={() => setTool(\"delete\")}\n\t\t\t\t\tclassName=\"tool\"\n\t\t\t\t/>\n\t\t\t\t<label\n\t\t\t\t\thtmlFor=\"delete\"\n\t\t\t\t\tclassName=\"tool__label\"\n\t\t\t\t>\n\t\t\t\t\t<img src={deleteicon} alt=\"delete icon\" className=\"toolbar__icon\"/>\n\t\t\t\t</label>\n\t\t\t</div>\n\n\t\t\t{/* Nav Bar Component */}\n\n\t\t\t<nav className=\"nav\">\n\t\t\t\t<button onClick={() => setDarkTheme(prevTheme => !prevTheme)}>\n\t\t\t\t\tToggle Theme\n\t\t\t\t</button>\n\t\t\t\t<Link to=\"/\">\n\t\t\t\t\t<img src={home} alt=\"home icon\" className=\"nav__icon\"/>\n\t\t\t\t</Link>\n\t\t\t\t<Link to=\"/about\">\n\t\t\t\t\t<img src={about} alt=\"about icon\" className=\"nav__icon\"/>\n\t\t\t\t</Link>\n\t\t\t</nav>\n\n\n\n\t\t\t{/* Canvas Component */}\n      <canvas\n        id=\"canvas\"\n        width={window.innerWidth}\n        height={window.innerHeight}\n        onMouseDown={handleMouseDown}\n        onMouseMove={handleMouseMove}\n        onMouseUp={handleMouseUp}\n      >\n        Canvas\n\t\t\t  </canvas>\n\t\t</div>\n    </>\n  )\n}\n\nexport default CanvasPage;\n"]},"metadata":{},"sourceType":"module"}